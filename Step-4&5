# ---------------------- CSRF Token Route --------------------------------------- (Step 4)
    @app.route("/csrf", methods=["GET"])
    @login_required
    def get_csrf_token():
        """
        Issues a CSRF token tied to the current session.

        Frontend should call GET /csrf after login and then send this token
        in the 'x-csrf-token' header for all POST/PUT/DELETE requests to /api/*.
        """
        token = session.get("csrf_token")
        if not token:
            token = token_urlsafe(32)
            session["csrf_token"] = token

        return jsonify({"csrf_token": token})

#THIS NEEDS TO BE ADDED I BELIEVE INSIDE YOUR CREATE_APP() TO WORK

# ---------------------- CSRF Protection for API Writes ------------------------
    @app.before_request
    def csrf_protect_api():
        """
        Enforce CSRF token on all modifying API requests.

        - Only applies to POST/PUT/DELETE
        - Only for routes under /api/
        - Token must be sent in 'x-csrf-token' header
        - Token must match the one stored in the session by /csrf
        """
        if request.method in ("POST", "PUT", "DELETE"):
            if request.path.startswith("/api/"):
                header_token = request.headers.get("x-csrf-token")
                session_token = session.get("csrf_token")

                if not session_token or not header_token or header_token != session_token:
                    return jsonify({"error": "Invalid CSRF token"}), 403

THIS ALSO NEEDS TO BE IN CREATE_APP() AFTER ROUTE DEFINITIONS BUT BEFORE THE RETURN APP IF I HAVE THE LOGIC CORRECT 
    # --------------- Logout and Session Destruction -------------------------------
    @app.route("/logout")
    @login_required
    def logout():
        """
        Logs the user out, clears the server-side session and expires the cookie.
        After this, protected endpoints should return 401 Unauthorized.
        """
        # Flask-Login: remove user from session
        logout_user()

        # Clear all data from the session (including csrf_token)
        session.clear()

        # Build a redirect response
        response = redirect(url_for('hello_world'))

        # Explicitly expire the session cookie in the browser
        response.set_cookie(app.session_cookie_name, '', expires=0)

        flash("You have been logged out.", 'info')
        return response

THIS IS INSIDE CREATE_APP() STILL TO CLEAR ALL DATA AND EXPIRE THE SESSION  COOKIE
